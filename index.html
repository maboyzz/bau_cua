<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game B·∫ßu Cua T√¥m C√° - NT Huy Pro</title>
    <style>
        :root {
            /* B·∫£ng m√†u T·∫øt: ƒê·ªè & V√†ng */
            --primary-color: #D32F2F;
            /* ƒê·ªè ƒë·∫≠m */
            --accent-color: #FFC107;
            /* V√†ng kim */
            --secondary-color: #FFF9C4;
            /* Kem s√°ng */
            --success-color: #388E3C;
            /* Xanh l√° */
            --text-color: #333;
            --bg-gradient-1: #FF5252;
            --bg-gradient-2: #D32F2F;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-1), var(--bg-gradient-2));
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        /* --- Header --- */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--accent-color);
        }

        h1 {
            color: var(--primary-color);
            margin: 0;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.1);
            font-size: 1.8em;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        /* --- Buttons --- */
        .btn-icon,
        button {
            background-color: var(--primary-color);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #9e1c1c;
            /* T·∫°o hi·ªáu ·ª©ng n√∫t n·ªïi 3D */
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 15px;
        }

        .btn-icon:hover,
        button:hover {
            background-color: #b71c1c;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #9e1c1c;
        }

        .btn-icon:active,
        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* --- Layout Ch√≠nh (QUAN TR·ªåNG) --- */
        .container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            /* Chia c·ªôt 3 ph·∫ßn game - 1 ph·∫ßn l·ªãch s·ª≠ */
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            transition: all 0.3s;
        }

        .container.hide-sidebar {
            grid-template-columns: 1fr;
        }

        .sidebar.hidden {
            display: none;
        }

        /* --- Khung Game & Sidebar --- */
        .game-board,
        .sidebar {
            background: var(--secondary-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 4px solid var(--accent-color);
            /* Vi·ªÅn v√†ng ƒë·∫≠m */
        }

        .sidebar {
            max-height: 800px;
            overflow-y: auto;
        }

        /* --- Khu v·ª±c Nh√† C√°i & X√∫c X·∫Øc (QUAN TR·ªåNG) --- */
        .dealer-section {
            text-align: center;
            border-bottom: 2px dashed var(--primary-color);
            padding-bottom: 20px;
            margin-bottom: 20px;
            position: relative;
            min-height: 250px;
            /* ƒê·∫£m b·∫£o ƒë·ªß cao cho b√°t */
        }

        #dealer-name-display {
            color: var(--primary-color);
            font-size: 1.5em;
            margin: 0;
            font-weight: bold;
            text-transform: uppercase;
        }

        #dealer-balance {
            font-weight: bold;
            color: #c0392b;
            font-size: 1.2em;
        }

        /* --- Layout X√∫c X·∫Øc --- */
        .dice-area {
            position: relative;
            width: 300px;
            height: 150px;
            margin: 40px auto 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        /* --- Vi√™n X√∫c X·∫Øc --- */
        .dice {
            width: 80px;
            height: 80px;
            background-color: white;
            border: 2px solid #ccc;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            box-shadow: 0 6px 0 #bdc3c7;
            z-index: 1;
        }

        @keyframes spinDice {
            0% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-50px) rotate(120deg);
            }

            50% {
                transform: translateY(0) rotate(240deg);
            }

            75% {
                transform: translateY(-30px) rotate(300deg);
            }

            100% {
                transform: translateY(0) rotate(360deg);
            }
        }

        .dice.shaking {
            animation: spinDice 0.5s infinite linear;
        }

        /* --- C√°i B√°t (·∫¢nh) --- */
        #the-bowl {
            width: 400px;
            height: 400px;
            background-image: url('cai-bat.png');
            /* ƒê·∫£m b·∫£o t√™n file ·∫£nh ƒë√∫ng */
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            position: absolute;
            top: -85px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            cursor: grab;
            transition: top 0.5s ease-out, opacity 0.3s;
        }

        #the-bowl:active {
            cursor: grabbing;
        }

        .bowl-open {
            top: -600px !important;
            opacity: 0;
            pointer-events: none;
        }

        /* --- B√†n C∆∞·ª£c --- */
        .betting-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .bet-option {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
            position: relative;
        }

        .bet-option:hover {
            border-color: var(--accent-color);
            background: #fffce0;
            transform: scale(1.05);
        }

        .bet-option.selected {
            border-color: var(--primary-color);
            background: #ffebee;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.3);
        }

        .symbol-icon {
            font-size: 40px;
            display: block;
        }

        .symbol-name {
            font-weight: bold;
            color: var(--primary-color);
        }

        .current-bet-display {
            font-size: 0.9em;
            color: var(--success-color);
            font-weight: bold;
            min-height: 1.2em;
            margin-top: 5px;
        }

        /* --- Controls Area --- */
        .controls {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #ddd;
        }

        .control-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .control-row label {
            font-weight: bold;
            color: #555;
            min-width: 90px;
        }

        select,
        input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
            outline: none;
        }

        select:focus,
        input:focus {
            border-color: var(--primary-color);
        }

        #btn-action {
            width: 100%;
            font-size: 20px;
            padding: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #btn-action.btn-open {
            background-color: var(--success-color);
            border-color: #2e7d32;
            box-shadow: 0 4px 0 #1b5e20;
        }

        #btn-action.btn-open:hover {
            background-color: #2e7d32;
        }

        /* --- Player Info & Modal --- */
        .player-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
            margin-bottom: 5px;
            border-radius: 5px;
        }

        .player-card.dealer {
            background: #ffebee;
            font-weight: bold;
        }

        .money-hidden .money-value {
            display: none;
        }

        .money-hidden .money-value::after {
            content: "*****";
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            width: 550px;
            max-width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary-color);
        }

        .form-group {
            display: grid;
            grid-template-columns: 0.5fr 2fr 1.5fr 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-footer {
            margin-top: 20px;
            text-align: right;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        /* Log entries */
        .log-entry {
            font-size: 13px;
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px dashed #ccc;
            background: white;
            border-radius: 4px;
        }

        .win {
            color: var(--success-color);
            font-weight: bold;
        }

        .lose {
            color: var(--primary-color);
        }
    </style>
</head>

<body>

    <div class="header-container">
        <h1>üé≤ B·∫ßu Cua Ultimate - NT Huy Pro</h1>
        <div class="header-right">
            <button class="btn-icon" onclick="toggleMoney()" title="·∫®n/Hi·ªán Ti·ªÅn">
                üí∞ <span id="money-status">Hi·ªán</span>
            </button>
            <button class="btn-icon" onclick="toggleSidebar()" title="·∫®n/Hi·ªán L·ªãch S·ª≠">
                üìú <span id="history-status">Hi·ªán</span>
            </button>
            <button class="btn-icon" onclick="openSettings()">‚öôÔ∏è C√†i ƒë·∫∑t</button>
        </div>
    </div>

    <div class="container" id="main-container">
        <div class="game-board">

            <div class="dealer-section">
                <h3 id="dealer-name-display">Nh√† C√°i</h3>
                <div id="dealer-balance" class="money-value">Ti·ªÅn: 0 $</div>

                <div class="dice-area">
                    <div class="dice" id="d1">?</div>
                    <div class="dice" id="d2">?</div>
                    <div class="dice" id="d3">?</div>

                    <div id="the-bowl" class="bowl-open" title="K√©o t√¥i ƒë·ªÉ m·ªü!"></div>
                </div>
            </div>

            <div class="betting-grid" id="betting-board"></div>

            <div class="controls">
                <h3>Khu V·ª±c ƒê·∫∑t C∆∞·ª£c</h3>
                <div class="control-row">
                    <label>Ng∆∞·ªùi ch∆°i:</label>
                    <select id="player-select"></select>
                    <span id="current-player-balance" style="font-weight: bold; color: var(--success-color)"></span>
                </div>
                <div class="control-row">
                    <label>C·ª≠a c∆∞·ª£c:</label>
                    <input type="text" id="selected-symbol-name" readonly placeholder="Ch·ªçn h√¨nh" style="flex:1">
                    <input type="hidden" id="selected-symbol-index">
                </div>
                <div class="control-row">
                    <label>Ti·ªÅn c∆∞·ª£c:</label>
                    <input type="number" id="bet-amount" placeholder="Nh·∫≠p ti·ªÅn" min="1" step="10">
                    <button onclick="handlePlaceBet()">X√°c nh·∫≠n</button>
                </div>
                <button id="btn-action" onclick="handleGameAction()">X√ìC (ƒê√≥ng B√°t)</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <h3>Danh s√°ch ng∆∞·ªùi ch∆°i</h3>
            <div id="player-list" class="balance-info"></div>
            <hr>
            <h3>L·ªãch s·ª≠</h3>
            <div id="game-log"></div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>C√†i ƒê·∫∑t Game</h2>
                <span style="cursor:pointer; font-size:24px" onclick="closeSettings()">&times;</span>
            </div>
            <div id="settings-body">
                <h4 style="color:var(--accent-color)">Nh√† C√°i</h4>
                <div class="form-group" style="grid-template-columns: 1fr 2fr;">
                    <label>T√™n:</label> <input type="text" id="set-dealer-name">
                    <label>Ti·ªÅn:</label> <input type="number" id="set-dealer-money">
                </div>
                <hr>
                <h4 style="color:var(--primary-color)">Ng∆∞·ªùi Ch∆°i</h4>
                <div style="font-size: 0.8em; color: #666; margin-bottom: 5px;">ID | T√™n | Ti·ªÅn | Avatar</div>
                <div id="players-settings-container"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closeSettings()" style="background:#95a5a6">H·ªßy</button>
                <button onclick="saveSettings()" style="background:var(--success-color)">L∆∞u</button>
            </div>
        </div>
    </div>

    <script>
        /** --- C·∫§U H√åNH --- */
        const SYMBOLS = [
            { name: 'B·∫ßu', icon: 'üçê' }, { name: 'Cua', icon: 'ü¶Ä' },
            { name: 'T√¥m', icon: 'ü¶ê' }, { name: 'C√°', icon: 'üêü' },
            { name: 'Nai', icon: 'ü¶å' }, { name: 'G√†', icon: 'üêì' }
        ];
        const AVATARS = { male: 'üë±‚Äç‚ôÇÔ∏è', female: 'üë©' };

        // State
        let dealer = { name: "Nh√† C√°i", balance: 10000 };
        let players = [];
        let currentBets = [];
        let gameState = "IDLE";
        let diceResult = [0, 0, 0];

        // UI Toggles
        let showMoney = true;
        let showSidebar = true;

        // Drag Logic
        let dragItem = null;
        let active = false;
        let currentX, currentY, initialX, initialY;
        let xOffset = 0, yOffset = 0;

        /** --- KH·ªûI T·∫†O --- */
        function initGame() {
            for (let i = 1; i <= 6; i++) {
                players.push({
                    id: i, name: `Ng∆∞·ªùi ch∆°i ${i}`, balance: 1000, gender: 'male'
                });
            }
            renderBoard();
            updateUI();
            initBowlDrag();
            log("Ch√†o m·ª´ng! H√£y ƒë·∫∑t c∆∞·ª£c r·ªìi nh·∫•n X√≥c.");
        }

        /** --- CORE GAME LOGIC --- */
        function handleGameAction() {
            if (gameState === "IDLE") {
                if (currentBets.length === 0) return alert("Ch∆∞a ai ƒë·∫∑t c∆∞·ª£c c·∫£!");
                if (dealer.balance <= 0) return alert("Nh√† c√°i h·∫øt ti·ªÅn!");
                startShaking();
            } else if (gameState === "WAITING_OPEN") {
                openBowl();
            }
        }

        function startShaking() {
            gameState = "SHAKING";
            const btn = document.getElementById('btn-action');
            btn.disabled = true;
            btn.innerText = "ƒêang x√≥c...";

            // Reset v·ªã tr√≠ b√°t
            const bowl = document.getElementById('the-bowl');
            bowl.classList.remove('bowl-open');
            bowl.style.transform = "translate(-50%, 0)";
            xOffset = 0; yOffset = 0;

            // X√∫c x·∫Øc xoay
            const dices = document.querySelectorAll('.dice');
            dices.forEach(d => {
                d.classList.add('shaking');
                d.innerText = "?";
            });

            // T√≠nh k·∫øt qu·∫£
            diceResult = [
                Math.floor(Math.random() * 6),
                Math.floor(Math.random() * 6),
                Math.floor(Math.random() * 6)
            ];

            setTimeout(() => {
                dices.forEach(d => d.classList.remove('shaking'));
                document.getElementById('d1').innerText = SYMBOLS[diceResult[0]].icon;
                document.getElementById('d2').innerText = SYMBOLS[diceResult[1]].icon;
                document.getElementById('d3').innerText = SYMBOLS[diceResult[2]].icon;

                gameState = "WAITING_OPEN";
                btn.disabled = false;
                btn.innerText = "M·ªû B√ÅT (Ho·∫∑c k√©o b√°t ra)";
                btn.classList.add('btn-open');
            }, 1500);
        }

        function openBowl() {
            if (gameState !== "WAITING_OPEN") return;

            const bowl = document.getElementById('the-bowl');
            bowl.classList.add('bowl-open');

            setTimeout(() => {
                calculateResult();
                const btn = document.getElementById('btn-action');
                btn.innerText = "X√ìC (ƒê√≥ng B√°t)";
                btn.classList.remove('btn-open');
                gameState = "IDLE";
            }, 500);
        }

        function calculateResult() {
            let counts = [0, 0, 0, 0, 0, 0];
            diceResult.forEach(i => counts[i]++);

            let totalPayout = 0;
            let dealerProfit = 0;

            currentBets.forEach(bet => {
                const player = players.find(p => p.id == bet.playerId);
                const occ = counts[bet.symbolIndex];

                if (occ > 0) {
                    const profit = bet.amount * occ;
                    player.balance += (bet.amount + profit);
                    totalPayout += profit;
                    log(`<span class="win">${player.name} tr√∫ng ${SYMBOLS[bet.symbolIndex].name} (+${profit}$)</span>`);
                } else {
                    dealerProfit += bet.amount;
                    log(`<span class="lose">${player.name} thua ${SYMBOLS[bet.symbolIndex].name} (-${bet.amount}$)</span>`);
                }
            });

            const net = dealerProfit - totalPayout;
            dealer.balance += net;

            log(net >= 0 ? `<b>Nh√† c√°i l√£i: ${net}$</b>` : `<b class="lose">Nh√† c√°i l·ªó: ${Math.abs(net)}$</b>`);

            if (dealer.balance < 0) {
                alert("Nh√† c√°i v·ª° n·ª£!"); dealer.balance = 0;
            }

            currentBets = [];
            updateUI();
            renderBoard();
        }

        /** --- BETTING LOGIC --- */
        function handlePlaceBet() {
            if (gameState !== "IDLE") return alert("ƒêang x√≥c, ch·ªù v√°n sau!");

            const pid = document.getElementById('player-select').value;
            const symIdx = document.getElementById('selected-symbol-index').value;
            const amount = parseInt(document.getElementById('bet-amount').value);

            if (symIdx === "") return alert("Ch∆∞a ch·ªçn h√¨nh!");
            if (!amount || amount <= 0) return alert("Ti·ªÅn kh√¥ng h·ª£p l·ªá!");

            const player = players.find(p => p.id == pid);
            if (player.balance < amount) return alert("Kh√¥ng ƒë·ªß ti·ªÅn!");

            player.balance -= amount;
            currentBets.push({ playerId: pid, symbolIndex: parseInt(symIdx), amount: amount });

            updateUI();
            renderBoardBetInfo();
            log(`${player.name} c∆∞·ª£c ${amount}$ v√†o ${SYMBOLS[symIdx].name}`);
        }

        /** --- DRAG LOGIC --- */
        function initBowlDrag() {
            const bowl = document.getElementById("the-bowl");
            const container = document.querySelector(".dealer-section");

            container.addEventListener("touchstart", dragStart, false);
            container.addEventListener("touchend", dragEnd, false);
            container.addEventListener("touchmove", drag, false);

            container.addEventListener("mousedown", dragStart, false);
            container.addEventListener("mouseup", dragEnd, false);
            container.addEventListener("mousemove", drag, false);

            function dragStart(e) {
                if (gameState !== "WAITING_OPEN") return;

                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }

                if (e.target === bowl || bowl.contains(e.target)) {
                    active = true;
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                active = false;

                if (gameState === "WAITING_OPEN" && (Math.abs(xOffset) > 100 || Math.abs(yOffset) > 100)) {
                    openBowl();
                } else if (gameState === "WAITING_OPEN") {
                    xOffset = 0; yOffset = 0;
                    setTranslate(0, 0, bowl);
                }
            }

            function drag(e) {
                if (active) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX; yOffset = currentY;
                    setTranslate(currentX, currentY, bowl);
                }
            }

            function setTranslate(xPos, yPos, el) {
                el.style.transform = `translate(calc(-50% + ${xPos}px), ${yPos}px)`;
            }
        }

        /** --- UI HELPERS --- */
        function renderBoard() {
            const board = document.getElementById('betting-board');
            board.innerHTML = '';
            SYMBOLS.forEach((sym, index) => {
                const div = document.createElement('div');
                div.className = 'bet-option';
                div.onclick = () => {
                    document.getElementById('selected-symbol-name').value = sym.name;
                    document.getElementById('selected-symbol-index').value = index;
                    document.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));
                    div.classList.add('selected');
                };
                div.innerHTML = `
                <span class="symbol-icon">${sym.icon}</span>
                <span class="symbol-name">${sym.name}</span>
                <div class="current-bet-display" id="bet-display-${index}"></div>
            `;
                board.appendChild(div);
            });
        }

        function renderBoardBetInfo() {
            for (let i = 0; i < 6; i++) document.getElementById(`bet-display-${i}`).innerText = "";
            let totals = [0, 0, 0, 0, 0, 0];
            currentBets.forEach(bet => totals[bet.symbolIndex] += bet.amount);
            totals.forEach((t, i) => {
                if (t > 0) document.getElementById(`bet-display-${i}`).innerText = `T·ªïng: ${t}$`;
            });
        }

        function updateUI() {
            document.getElementById('dealer-name-display').innerText = dealer.name;
            document.getElementById('dealer-balance').innerText = `Ti·ªÅn: ${dealer.balance}$`;

            const select = document.getElementById('player-select');
            const oldVal = select.value;
            select.innerHTML = '';
            players.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.text = `${AVATARS[p.gender]} ${p.name}`;
                select.appendChild(opt);
            });
            if (oldVal) select.value = oldVal;

            const pid = select.value || players[0].id;
            const pObj = players.find(p => p.id == pid);
            if (pObj) document.getElementById('current-player-balance').innerText = `(D∆∞: ${pObj.balance}$)`;
            select.onchange = () => updateUI();

            const list = document.getElementById('player-list');
            list.innerHTML = '';

            const dDiv = document.createElement('div');
            dDiv.className = 'player-card dealer';
            dDiv.style.background = '#ffeaea';
            dDiv.innerHTML = `<span>üé© ${dealer.name}</span> <span class="money-value">${dealer.balance}$</span>`;
            list.appendChild(dDiv);

            players.forEach(p => {
                const div = document.createElement('div');
                div.className = 'player-card';
                div.innerHTML = `
                <span><span class="player-avatar">${AVATARS[p.gender]}</span> ${p.name}</span> 
                <span class="money-value">${p.balance}$</span>
            `;
                list.appendChild(div);
            });

            applyHideMoney();
        }

        function log(msg) {
            const d = document.getElementById('game-log');
            const e = document.createElement('div');
            e.className = 'log-entry';
            e.innerHTML = msg;
            d.insertBefore(e, d.firstChild);
        }

        function toggleMoney() {
            showMoney = !showMoney;
            document.getElementById('money-status').innerText = showMoney ? "Hi·ªán" : "·∫®n";
            applyHideMoney();
        }

        function applyHideMoney() {
            const elements = document.querySelectorAll('.money-value, #current-player-balance, #dealer-balance');
            elements.forEach(el => {
                if (!showMoney) {
                    if (!el.getAttribute('data-origin')) el.setAttribute('data-origin', el.innerText);
                    el.innerText = "*****";
                } else {
                    if (el.id === 'dealer-balance') el.innerText = `Ti·ªÅn: ${dealer.balance}$`;
                    else if (el.id === 'current-player-balance') {
                        const pid = document.getElementById('player-select').value;
                        const p = players.find(x => x.id == pid);
                        if (p) el.innerText = `(D∆∞: ${p.balance}$)`;
                    }
                }
            });
        }

        function toggleSidebar() {
            showSidebar = !showSidebar;
            document.getElementById('history-status').innerText = showSidebar ? "Hi·ªán" : "·∫®n";
            const sb = document.getElementById('sidebar');
            const ct = document.getElementById('main-container');
            if (showSidebar) { sb.classList.remove('hidden'); ct.classList.remove('hide-sidebar'); }
            else { sb.classList.add('hidden'); ct.classList.add('hide-sidebar'); }
        }

        function openSettings() {
            document.getElementById('set-dealer-name').value = dealer.name;
            document.getElementById('set-dealer-money').value = dealer.balance;
            const cont = document.getElementById('players-settings-container');
            cont.innerHTML = '';
            players.forEach((p, idx) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                <label>P${p.id}:</label>
                <input type="text" id="set-name-${idx}" value="${p.name}">
                <input type="number" id="set-money-${idx}" value="${p.balance}">
                <div class="radio-group">
                    <label><input type="radio" name="gender-${idx}" value="male" ${p.gender == 'male' ? 'checked' : ''}>Nam</label>
                    <label><input type="radio" name="gender-${idx}" value="female" ${p.gender == 'female' ? 'checked' : ''}>N·ªØ</label>
                </div>
            `;
                cont.appendChild(div);
            });
            document.getElementById('settings-modal').style.display = 'flex';
        }

        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }

        function saveSettings() {
            dealer.name = document.getElementById('set-dealer-name').value;
            dealer.balance = parseInt(document.getElementById('set-dealer-money').value);
            players.forEach((p, idx) => {
                p.name = document.getElementById(`set-name-${idx}`).value;
                p.balance = parseInt(document.getElementById(`set-money-${idx}`).value);
                p.gender = document.querySelector(`input[name="gender-${idx}"]:checked`).value;
            });
            updateUI();
            closeSettings();
        }

        window.onload = initGame;
    </script>
</body>

</html>